{
  "id": "zephyr-dev",
  "version": "1.0.0",
  "name": "Zephyr RTOS Development Environment",
  "description": "Comprehensive development environment for Zephyr RTOS with debugging, extensions, and tools",
  "documentationURL": "https://github.com/zephyrproject-rtos/zephyr",
  "licenseURL": "https://github.com/zephyrproject-rtos/zephyr/blob/main/LICENSE",
  "options": {
    "enableDebugging": {
      "type": "boolean",
      "default": true,
      "description": "Enable hardware debugging support with J-Link"
    },
    "enableCodeQuality": {
      "type": "boolean", 
      "default": true,
      "description": "Enable code quality tools (clang-format, cppcheck, pre-commit)"
    },
    "enableClaude": {
      "type": "boolean",
      "default": true,
      "description": "Install Claude Code CLI and VS Code extension"
    }
  },
  "installsAfter": [
    "ghcr.io/devcontainers/features/common-utils"
  ],
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-vscode.cpptools-extension-pack",
        "ms-vscode.cmake-tools", 
        "ms-python.python",
        "ms-python.flake8",
        "ms-python.pylint",
        "marus25.cortex-debug",
        "dan-c-underwood.arm",
        "zixuanwang.linkerscript",
        "ms-vscode.vscode-serial-monitor",
        "redhat.vscode-yaml",
        "ms-vscode.hexeditor",
        "GitHub.copilot",
        "GitHub.copilot-chat", 
        "Anthropic.claude-code"
      ],
      "settings": {
        "files.associations": {
          "*.overlay": "yaml",
          "*.dts": "yaml", 
          "*.dtsi": "yaml",
          "Kconfig*": "kconfig",
          "*.conf": "kconfig",
          "*.defconfig": "kconfig",
          "*.ld": "linkerscript",
          "*.cmake": "cmake",
          "CMakeLists.txt": "cmake"
        },
        "C_Cpp.default.configurationProvider": "ms-vscode.cmake-tools",
        "C_Cpp.default.compilerPath": "/opt/zephyr-sdk/arm-zephyr-eabi/bin/arm-zephyr-eabi-gcc",
        "C_Cpp.default.includePath": [
          "${workspaceFolder}/**",
          "/opt/zephyr-project/zephyr/include/**",
          "/opt/zephyr-sdk/arm-zephyr-eabi/arm-zephyr-eabi/include/**"
        ],
        "C_Cpp.default.defines": [
          "__GNUC__",
          "CONFIG_ZEPHYR_APP=1"
        ],
        "cmake.configureOnOpen": false,
        "cmake.sourceDirectory": "${workspaceFolder}",
        "cmake.buildDirectory": "${workspaceFolder}/build",
        "python.defaultInterpreterPath": "/usr/bin/python3",
        "terminal.integrated.defaultProfile.linux": "bash",
        "cortex-debug.armToolchainPath": "/opt/zephyr-sdk/arm-zephyr-eabi/bin",
        "cortex-debug.JLinkGDBServerPath": "/opt/JLink/JLinkGDBServerCLExe",
        "search.exclude": {
          "**/build": true,
          "**/zephyrproject": true,
          "**/.west": true
        },
        "files.exclude": {
          "**/build": true
        },
        "editor.tabSize": 2,
        "editor.insertSpaces": true,
        "editor.detectIndentation": false
      },
      "tasks": [
        {
          "label": "Zephyr: Build",
          "type": "shell",
          "command": "west",
          "args": ["build"],
          "group": {
            "kind": "build",
            "isDefault": true
          },
          "problemMatcher": ["$gcc"],
          "presentation": {
            "echo": true,
            "reveal": "always",
            "focus": false,
            "panel": "shared"
          }
        },
        {
          "label": "Zephyr: Clean Build",
          "type": "shell", 
          "command": "west",
          "args": ["build", "-t", "clean"],
          "group": "build"
        },
        {
          "label": "Zephyr: Flash",
          "type": "shell",
          "command": "west", 
          "args": ["flash"],
          "group": "build",
          "dependsOn": "Zephyr: Build"
        },
        {
          "label": "Zephyr: Menuconfig",
          "type": "shell",
          "command": "west",
          "args": ["build", "-t", "menuconfig"],
          "group": "build"
        }
      ]
    }
  },
  "mounts": [
    "source=${localWorkspaceFolder},target=/workdir,type=bind,consistency=cached"
  ],
  "workspaceFolder": "/workdir",
  "remoteUser": "user",
  "postCreateCommand": "echo 'Zephyr development environment ready!'",
  "forwardPorts": [
    2331,
    19021
  ],
  "portsAttributes": {
    "2331": {
      "label": "J-Link GDB Server",
      "onAutoForward": "notify"
    },
    "19021": {
      "label": "J-Link RTT Viewer",
      "onAutoForward": "notify"
    }
  }
}